# æ•°æ®åº“å®Œå…¨é‡å»ºæŒ‡å—

## âš ï¸ é‡è¦è­¦å‘Š

**æ­¤æ“ä½œå°†åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰ç°æœ‰æ•°æ®ï¼**

æ‰§è¡Œå‰è¯·ç¡®ä¿ï¼š
1. å·²å¤‡ä»½é‡è¦æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
2. ç†è§£æ­¤æ“ä½œä¸å¯é€†
3. å·²è·å¾—ç›¸å…³æˆæƒ

## ğŸ“‹ é‡å»ºå†…å®¹

æ­¤è„šæœ¬å°†åˆ›å»ºä»¥ä¸‹å®Œæ•´çš„æ•°æ®åº“ç»“æ„ï¼š

### 1ï¸âƒ£ **profiles è¡¨**
ç”¨æˆ·æ¡£æ¡ˆè¡¨ï¼ŒåŒ…å«ï¼š
- åŸºç¡€ä¿¡æ¯ï¼šç”¨æˆ·åã€å¤´åƒ
- ä¸ªæ€§åŒ–ä¿¡æ¯ï¼šMBTIã€èŒä¸šã€ç›®æ ‡
- æ‰“å¡ç»Ÿè®¡ï¼šæ€»æ‰“å¡æ•°ã€è¿ç»­å¤©æ•°ã€é‡‘å¸ã€å¾½ç« 
- æ—¶é—´æˆ³ï¼šåˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´

### 2ï¸âƒ£ **daily_actions è¡¨**
æ¯æ—¥è¡ŒåŠ¨è¡¨ï¼ŒåŒ…å«ï¼š
- è¡ŒåŠ¨ä¿¡æ¯ï¼šæ—¥æœŸã€æ ‡é¢˜ã€æè¿°ã€emoji
- åˆ†ç±»ä¿¡æ¯ï¼šä¸»é¢˜ã€ç±»åˆ«
- å®ŒæˆçŠ¶æ€ï¼šæ˜¯å¦å®Œæˆã€å®Œæˆæ—¶é—´

### 3ï¸âƒ£ **check_ins è¡¨**
æ‰“å¡è®°å½•è¡¨ï¼ŒåŒ…å«ï¼š
- æ‰“å¡ä¿¡æ¯ï¼šæ—¥æœŸã€å…³è”è¡ŒåŠ¨ã€å¤‡æ³¨
- è‡ªåŠ¨å…³è”åˆ° profiles è¡¨ï¼Œæ›´æ–°ç»Ÿè®¡æ•°æ®

### 4ï¸âƒ£ **è‡ªåŠ¨è§¦å‘å™¨**
- âœ… æ–°ç”¨æˆ·æ³¨å†Œè‡ªåŠ¨åˆ›å»º profile
- âœ… æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–° updated_at æ—¶é—´æˆ³
- âœ… æ‰“å¡åè‡ªåŠ¨æ›´æ–°ç»Ÿè®¡æ•°æ®ï¼ˆè¿ç»­å¤©æ•°ã€é‡‘å¸ç­‰ï¼‰

### 5ï¸âƒ£ **å®‰å…¨ç­–ç•¥ (RLS)**
- âœ… æ‰€æœ‰è¡¨å¯ç”¨è¡Œçº§å®‰å…¨
- âœ… ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®

## ğŸš€ æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1: è®¿é—® Supabase Dashboard

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttps://supabase.com/dashboard
2. ç™»å½•æ‚¨çš„è´¦æˆ·
3. é€‰æ‹©é¡¹ç›®ï¼š**richca**

### æ­¥éª¤ 2: æ‰“å¼€ SQL Editor

1. ç‚¹å‡»å·¦ä¾§èœå•çš„ **SQL Editor**
2. ç‚¹å‡» **+ New query** åˆ›å»ºæ–°æŸ¥è¯¢

### æ­¥éª¤ 3: æ‰§è¡Œé‡å»ºè„šæœ¬

1. æ‰“å¼€æ–‡ä»¶ï¼š`supabase/migrations/007_complete_database_rebuild.sql`
2. å¤åˆ¶**å…¨éƒ¨å†…å®¹**
3. ç²˜è´´åˆ° SQL Editor ä¸­
4. ç‚¹å‡»å³ä¸‹è§’çš„ **Run** æŒ‰é’®

### æ­¥éª¤ 4: ç­‰å¾…æ‰§è¡Œå®Œæˆ

æ‰§è¡Œè¿‡ç¨‹å¤§çº¦éœ€è¦ **5-10 ç§’**ã€‚

æˆåŠŸåï¼Œæ‚¨ä¼šçœ‹åˆ°ï¼š
```
Success. No rows returned
```

## âœ… éªŒè¯æ•°æ®åº“

æ‰§è¡ŒæˆåŠŸåï¼Œæ‚¨å¯ä»¥éªŒè¯æ•°æ®åº“ç»“æ„ï¼š

### æŸ¥çœ‹æ‰€æœ‰è¡¨

```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;
```

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… check_ins
- âœ… daily_actions
- âœ… profiles

### æŸ¥çœ‹ profiles è¡¨ç»“æ„

```sql
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = 'profiles'
ORDER BY ordinal_position;
```

åº”è¯¥åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- id (uuid)
- username (varchar)
- avatar (varchar)
- mbti (varchar)
- role (varchar)
- goal (text)
- total_check_ins (integer)
- current_streak (integer)
- longest_streak (integer)
- total_coins (integer)
- badges (text[])
- created_at (timestamptz)
- updated_at (timestamptz)

## ğŸ§ª æµ‹è¯•æ–°æ•°æ®åº“

### 1. æµ‹è¯•ç”¨æˆ·æ³¨å†Œ

è®¿é—® https://rich365.ai å¹¶æ³¨å†Œä¸€ä¸ªæ–°è´¦æˆ·ã€‚

æ£€æŸ¥æ˜¯å¦è‡ªåŠ¨åˆ›å»ºäº† profileï¼š
```sql
SELECT id, username, avatar, created_at
FROM profiles
LIMIT 5;
```

### 2. æµ‹è¯•ç”Ÿæˆæ—¥å†

ç™»å½•åï¼Œåœ¨ onboarding é¡µé¢é€‰æ‹© MBTI å’ŒèŒä¸šï¼Œç”Ÿæˆæ—¥å†ã€‚

æ£€æŸ¥æ˜¯å¦åˆ›å»ºäº† daily_actionsï¼š
```sql
SELECT date, title, theme, category
FROM daily_actions
ORDER BY date
LIMIT 10;
```

### 3. æµ‹è¯•æ‰“å¡åŠŸèƒ½

å®Œæˆä¸€æ¬¡æ‰“å¡æ“ä½œã€‚

æ£€æŸ¥æ‰“å¡è®°å½•å’Œç»Ÿè®¡æ›´æ–°ï¼š
```sql
-- æŸ¥çœ‹æ‰“å¡è®°å½•
SELECT * FROM check_ins ORDER BY created_at DESC LIMIT 5;

-- æŸ¥çœ‹ç»Ÿè®¡æ•°æ®
SELECT username, total_check_ins, current_streak, total_coins
FROM profiles
WHERE total_check_ins > 0;
```

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: æ‰§è¡Œå¤±è´¥ï¼Œæç¤ºæƒé™é”™è¯¯ï¼Ÿ
A: ç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯é¡¹ç›®æ‰€æœ‰è€…è´¦æˆ·ï¼Œæˆ–å…·æœ‰è¶³å¤Ÿçš„æ•°æ®åº“æƒé™ã€‚

### Q: èƒ½å¦åªåˆ é™¤æ•°æ®ï¼Œä¿ç•™è¡¨ç»“æ„ï¼Ÿ
A: å¯ä»¥ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```sql
TRUNCATE profiles, daily_actions, check_ins CASCADE;
```

### Q: å¦‚ä½•æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Ÿ
A: æ­¤æ“ä½œä¸å¯é€†ã€‚å»ºè®®æ‰§è¡Œå‰å…ˆå¯¼å‡ºæ•°æ®å¤‡ä»½ã€‚

### Q: è§¦å‘å™¨æ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ
A: æ£€æŸ¥è§¦å‘å™¨æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š
```sql
SELECT trigger_name, event_object_table, action_statement
FROM information_schema.triggers
WHERE trigger_schema = 'public';
```

## ğŸ“Š æ•°æ®åº“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  auth.users                     â”‚
â”‚                 (Supabase Auth)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ id (FK)
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   profiles                      â”‚
â”‚  - username, avatar                             â”‚
â”‚  - mbti, role, goal                             â”‚
â”‚  - total_check_ins, current_streak              â”‚
â”‚  - longest_streak, total_coins, badges          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                      â”‚
           â”‚ user_id (FK)         â”‚ user_id (FK)
           â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   daily_actions      â”‚  â”‚     check_ins        â”‚
â”‚  - date, title       â”‚  â”‚  - date, note        â”‚
â”‚  - description       â”‚  â”‚  - action_id (FK)    â”‚
â”‚  - theme, category   â”‚  â”‚                      â”‚
â”‚  - completed         â”‚â—„â”€â”¤  (è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å®Œæˆåçš„ä¸‹ä¸€æ­¥

1. âœ… æ•°æ®åº“é‡å»ºå®Œæˆ
2. ğŸ”„ è®¿é—® https://rich365.ai æµ‹è¯•åº”ç”¨
3. ğŸ“Š éªŒè¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼š
   - ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
   - MBTI å’ŒèŒä¸šé€‰æ‹©
   - æ—¥å†ç”Ÿæˆ
   - æ‰“å¡åŠŸèƒ½
   - ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
   - ä¿å­˜å›¾ç‰‡åŠŸèƒ½

---

**å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ Supabase Dashboard çš„ Logs é¡µé¢è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚**
